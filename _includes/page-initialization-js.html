<script>
  $(document).ready(function () {
    // =============================================
    // = Initialize Table of Contents (If Present) =
    // =============================================
    
    // Since we can't touch the kramdown autogenrated TOC code,
    // instead just wrap it in the sitewide TOC class, since the rest
    // of it is very reasonably structured.
    $('#markdown-toc').wrap('<div class="table-of-contents"></div>');
    
    // Make the kramdown generated toc into a valid bootstrap nav
    $('#markdown-toc').addClass('nav');
    
    // To prevent flash-of-awkwardly-styled-content, the toc is hidden until
    // the processing above is done.
    $('.toc-page').removeClass('not-ready');
    $('body').scrollspy({
      target: '.table-of-contents', 
      offset: 75
    });
    

    // ========================
    // = Prettify Code Blocks =
    // ========================
    
    // Transform all pre blocks that were presumably autogenerated by markdown so
    // they'll be prettified too
    $('pre:not([class])').addClass('prettyprint source');
    $('pre[class=highlight]').addClass('prettyprint source');
    
    // Kramdown puts the language on the code element, but we want it on the pre
    // so the background can be styled too and we can vary the theme depending on
    // which language it is. The simplest solution is just to grab all the classes.
    $('.prettyprint').each(function (index, prettyPrintNode) {
      var classList = $(prettyPrintNode).children('code').attr('class');
      $(prettyPrintNode).addClass(classList);
    })
    
    window.prettyPrint();
    
    // Copied directly from the linenumbers.js file included with the
    // default JSDoc theme.
    (function () {
        var source = document.getElementsByClassName('prettyprint source linenums');
        var i = 0;
        var lineNumber = 0;
        var lineId;
        var lines;
        var totalLines;
        var anchorHash;

        if (source && source[0]) {
            anchorHash = document.location.hash.substring(1);
            lines = source[0].getElementsByTagName('li');
            totalLines = lines.length;

            for (; i < totalLines; i++) {
                lineNumber++;
                lineId = 'line' + lineNumber;
                lines[i].id = lineId;
                if (lineId === anchorHash) {
                    lines[i].className += ' selected';
                }
            }
        }
    })();
  });    
</script>
