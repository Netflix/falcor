.toc-page {

  .table-of-contents {
    position: absolute;
    right: 0;
    top: 0;
    padding-left: @content-toc-gap;
    // TODO: Fix
    max-height: 90vh;

    & > .nav {
      // Enough to overlap the footer, if it comes to that.
      z-index: 10;
      position: fixed;
      will-change: transform;
      padding: 0 0 7px 0;
      background-color: @toc-background;
      
      // Ensure the 
      max-height: 750px;
      // Ensure it can't be larger than the window height - the top reserved (nav + padding)
      // areas + an equal amount to the top content padding at the bottom (for vertical symmetry)
      // Unfortunately, on very short windows it will overlap the footer if it reaches the very
      // bottom of the page, but that seems better to me than the other way around, since that
      // would make the nav partly inaccessible.
      max-height: calc(~"100vh" - (@navbar-height + @site-content-padding-top * 2));
      overflow: auto;
      overflow-y: auto;
      overflow-x: inherit;

      // Since the TOC is position: fixed, it must be manually sized
      @media (min-width: @screen-sm-min) and (max-width: @screen-sm-max) {
        width: 277px - @content-toc-gap;
      }
      @media (min-width: @screen-md-min) and (max-width: @screen-md-max) {
        width: 291px - @content-toc-gap;
      }
      @media (min-width: @screen-lg-min) {
        width: 292px - @content-toc-gap;
      }
    }

    @media (max-width: @screen-xs-max) {
      display: none;
    }
    @media (min-width: @screen-sm-min) and (max-width: @screen-sm-max) {
      width: @toc-width-sm;
    }
    @media (min-width: @screen-md-min) and (max-width: @screen-md-max) {
      width: @toc-width-md;
    }
    @media (min-width: @screen-lg-min) {
      width: @toc-width-lg;
    }

    // List styling overrides for ToC lists
    //
    // These selectors are messier than I'd like, because there's no
    // way to get full control of the html generated by kramdown's
    // TOC generator so one can add semantic classes to them
    list-style: none;
    ul, li {
      padding-left: 0;
      list-style: none;
    }

    // All level items / defaults
    .nav li {
      & > a, & > span {
        display: block;
        padding-top: 1px;
        padding-bottom: 1px;
        padding-right: 15px;
        
      }
      & > a {
        color: @toc-link-color;
        &:hover {
          text-decoration: underline;
        }
      }
      &.active > a, &.active > a:hover {
        font-weight: 500;
      }
    }

    // First level items only
    .nav > li {
      padding-top: 10px;
      & > a {
        padding: 5px 10px 5px @toc-indentation-per-level;
        font-size: 16px;

        &:hover {
          background: transparent;
        }
      }
      &.active > a {
        &, &:hover {
          background-color: @toc-active-background;
        }
      }
    }

    // Second level items only
    .nav > li > ul > li {
      & > a {
        padding-left: @toc-indentation-per-level * 2;
      }

      &.active > a {
        &, &:hover {
          background-color: @toc-active-background-sub-item;
        }
      }
    }

    // Third level items only
    .nav > li > ul > li {
      & > .toc-api-subgroup {
        padding-top: 4px;
        padding-bottom: 4px;
      }
      & > ul > li {
        & > a, & > .toc-api-subgroup-title {
          padding-left: @toc-indentation-per-level * 3;
        }
        & > .toc-api-subgroup-title {
          font-weight: 700;
          color: @toc-subgroup-title-color;
          // Just looks nicer since that region is specifically for clickable
          // navigation items and headers, not text to be selected
          cursor: default;
        }

        &.active > a {
          &, &:hover {
            background-color: @toc-active-background-sub-item-sub-item;
          }
        }
      }
    } 
  }

  // Page sizing, to account for the space the ToC is taking up
  @media (max-width: @screen-sm-max) {
    padding-right: 0;
  }
  @media (min-width: @screen-sm-min) and (max-width: @screen-sm-max) {
    padding-right: @toc-width-sm;
  }
  @media (min-width: @screen-md-min) and (max-width: @screen-md-max) {
    padding-right: @toc-width-md;
  }
  @media (min-width: @screen-lg-min) {
    padding-right: @toc-width-lg;
  }

  /* Since we can't touch the html the TOC command generates, it looks mediocre
   until the page is ready and jquery can move it to its proper place. Until then,
   the not-ready class lets us hide it so the page doesn't jump suddenly.
  */
  &.not-ready #markdown-toc {
    display: none;
  }
}
